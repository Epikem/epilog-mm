---
date: "2018-05-30"
title: "TIL 2018-05-30"
categories: "prisma"
tags: ["prisma", "graphql"]
---

ì˜¤ëŠ˜ ë°°ìš´ ê²ƒ

----------

- [1. prismaì™€ graphql-cli ì—…ê·¸ë ˆì´ë“œ](#1-prismaì™€-graphql-cli-ì—…ê·¸ë ˆì´ë“œ)
- [2. prisma serverì˜ í¬íŠ¸ ë³€ê²½](#2-prisma-serverì˜-í¬íŠ¸-ë³€ê²½)
- [3. í”„ë¡ íŠ¸ì— prisma ìŠ¤í‚¤ë§ˆë¥¼ ì‚¬ìš©í•˜ê²Œ í•˜ê¸°. (ì‹¤íŒ¨)](#3-í”„ë¡ íŠ¸ì—-prisma-ìŠ¤í‚¤ë§ˆë¥¼-ì‚¬ìš©í•˜ê²Œ-í•˜ê¸°-ì‹¤íŒ¨)
- [dep](#dep)
- [ref](#ref)

## 1. prismaì™€ graphql-cli ì—…ê·¸ë ˆì´ë“œ

`yarn info prisma` ë° `yarn info graphql-cli`ë¡œ ì‚¬ìš© ê°€ëŠ¥í•œ ë²„ì „ í™•ì¸. ê·¸ë¦¬ê³  `package.json`íŒŒì¼ ìˆ˜ì •í•˜ì—¬ ì—…ê·¸ë ˆì´ë“œë¥¼ í•˜ë‹ˆ 2018-05-28ì— ë°œìƒí•œ ë¶ˆì¼ì¹˜ ë¬¸ì œê°€ ì‚¬ë¼ì¡Œë‹¤. ì´ê²ƒì€ playgroundì™€ prismaê°€ ëª¨ë‘ graphql-config-extension-prismaë¥¼ ì‚¬ìš©í•˜ê³ , ë”°ë¼ì„œ prisma.ymlì˜ ìŠ¤í‚¤ë§ˆê°€ ì¼ì¹˜í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì´ë¼ê³  í•œë‹¤.

ë¬¸ì œëŠ” ê·¸ë ‡ê²Œ í•œë‹¤ë©´ semverë¥¼ ë”°ë¥¼ ë•Œ ì• ì´ˆì— prismaì™€ graphql-cliì˜ ë©”ì´ì € ë²„ì „ì´ ì˜¬ë¼ê°€ì•¼ í•˜ëŠ”ê±° ì•„ë‹Œê°€..

ê·¸ë ‡ì§€ë§Œ ì—¬ì „íˆ í¬íŠ¸ ë³€ê²½ì€ ì•ˆ ë˜ê³  ìˆë‹¤..

## 2. prisma serverì˜ í¬íŠ¸ ë³€ê²½

ì„±ê³µ! GraphQLì„œë²„ì˜ ì‹œì‘ì— ì˜µì…˜ì„ ì£¼ì–´ì•¼ í–ˆë‹¤.

> ğŸ“ `index.js`

```js
server.start({ port: 4001 })
```

ì•ˆíƒ€ê¹ê²Œë„, `.graphqlconfig.yml`ì€ environment variableì„ ì‚¬ìš©í•  ë°©ë²•ì´ ì—†ìœ¼ë¯€ë¡œ í¬íŠ¸ë¥¼ ë³€ê²½í•  ë•Œ `.graphqlconfig.yml`ê³¼ `index.js`ì˜ ì‹œì‘ í¬íŠ¸ë¥¼ ê°™ì´ ë³€ê²½í•´ì¤„ ìˆ˜ ë°–ì— ì—†ëŠ” ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤. ì•„ë‹ˆë©´ ì•„ì˜ˆ `index.js`ì—ì„œ `.graphqlconfig.yml`ì˜ ê°’ì„ ì½ì–´ì˜¤ëŠ”ê²Œ ë” ë‚˜ì„ ë“¯.

js-yaml íŒ¨í‚¤ì§€ë¥¼ ì“°ë©´ ë  ë“¯í•˜ë‹¤.

js-yaml íŒ¨í‚¤ì§€ì™€ fs íŒ¨í‚¤ì§€ ê·¸ë¦¬ê³  ë…¸ë“œì˜ ê¸°ë³¸ íŒ¨í‚¤ì§€ì¸ urlì„ ì´ìš©í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•˜ë‹ˆ `.graphqlconfig.yaml`ì˜ ë‚´ìš©ì„ ì½ì„ ìˆ˜ ìˆì—ˆë‹¤.

```js
const yaml = require('js-yaml');
const fs = require('fs');
var url = require('url')

// Get document, or throw exception on error
let port = 4000;
try {
  let doc = yaml.safeLoad(fs.readFileSync('./.graphqlconfig.yaml', 'utf8'));
  const u = url.parse(doc.projects.app.extensions.endpoints.default);
  port = u.port;
} catch (e) {
  console.log(e);
}
console.log(`starting graphql server on port ${port}`)
server.start({ port })
```

## 3. í”„ë¡ íŠ¸ì— prisma ìŠ¤í‚¤ë§ˆë¥¼ ì‚¬ìš©í•˜ê²Œ í•˜ê¸°. (ì‹¤íŒ¨)

í˜„ì¬ í”„ë¡ íŠ¸ì˜ `app.js`ì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ dbì˜ local app graphgql endpointë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì„¤ì •í–ˆë”ë‹ˆ <http://localhost:8081/graphql> ì—ì„œ ìŠ¤í‚¤ë§ˆê°€ ì ìš©ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.

```js
config.setGraphQLEndpoint("http://localhost:<my port>");
```

ìƒë‹¹íˆ ì“¸ë§Œí•´ë³´ì´ëŠ” graphgql code ë°œê²¬ : <https://github.com/apollographql/react-apollo/issues/604>

```js
class App extends Component {
  render() {
    const { data: { refetch, loading, hero, error } } = this.props;
    if(loading) {
      return (<p>Loadingâ€¦</p>);
    }
    return (
      <main>
        <header>
          <h1>Apollo Client Error Template</h1>
          <p>{error && error.message}</p>
          <h3>{!error && hero.name}</h3>
          <button onClick={() => refetch().catch(e => null)}>
            Refetch
          </button>
        </header>
      </main>
    );
  }
}
```

## dep

## ref

-   [prisma forum qna](https://www.prisma.io/forum/t/how-to-fix-invalid-prisma-yml-file-prisma-yml-should-not-have-additional-properties-additionalproperty-endpoint-errors/3303)

-   [github prisma default port change issue](https://github.com/prismagraphql/prisma/issues/2264)

----------
